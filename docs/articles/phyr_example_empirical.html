<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pglmm example with empirical data • phyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="pglmm example with empirical data">
<meta property="og:description" content="phyr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmarks.html">Performance benchmark</a>
    </li>
    <li>
      <a href="../articles/pglmm.html">Usage of pglmm()</a>
    </li>
    <li>
      <a href="../articles/phyr_example_empirical.html">pglmm example with empirical data</a>
    </li>
    <li>
      <a href="../articles/plot-re.html">Plot random terms of communityPGLMM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/daijiang/phyr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>pglmm example with empirical data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/daijiang/phyr/blob/HEAD/vignettes/phyr_example_empirical.Rmd" class="external-link"><code>vignettes/phyr_example_empirical.Rmd</code></a></small>
      <div class="hidden name"><code>phyr_example_empirical.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="communitypglmm-example-on-simple-empirical-dataset">communityPGLMM Example on Simple Empirical Dataset<a class="anchor" aria-label="anchor" href="#communitypglmm-example-on-simple-empirical-dataset"></a>
</h2>
<p>This vignette will show a complete analysis example for
<code>pglmm</code> on a simple empirical dataset. The dataset is taken
from <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0007071" class="external-link">Dinnage
(2009)</a>. Here we will demonstrate how to fit a PGLMM, including main
phylogenetic effects, nested phylogenetic effects, as well as including
environmental covariates. First let’s load the dataset and take a look
at what we have. The data is included in <code>phyr</code>, so we can
just call <code>data(oldfield)</code> to load it.</p>
</div>
<div class="section level2">
<h2 id="modelling-old-field-plants-as-a-function-of-phylogeny-and-distubance">Modelling Old Field Plants as a Function of Phylogeny and
Distubance<a class="anchor" aria-label="anchor" href="#modelling-old-field-plants-as-a-function-of-phylogeny-and-distubance"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://daijiang.github.io/phyr/" class="external-link">phyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ape' was built under R version 4.2.2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.2.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ape':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     where</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"oldfield"</span><span class="op">)</span></span></code></pre></div>
<p>The data is a list with two elements. The first element is a
phylogeny containing 47 species of plants (all herbaceous forbs) that
live in old field habitats in Southern Ontario, Canada. Oldfield
habitats typically are found in areas that were formerly cultivated but
are now abandoned. This is often considered a successional stage between
farmland and secondary forest. These data come from plots that had
experienced two “treatments”: one set of plots had been disturbed by
field ploughing within a few years of sampling, whereas the other set
had not been disturbed in this way recently. Let’s have a look at the
phylogeny and data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">oldfield</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/init_plots-1.png" width="80%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">oldfield</span><span class="op">$</span><span class="va">data</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 7</span></span></span>
<span><span class="co">#&gt;    site_orig habitat_type sp            abundance disturbance site          pres</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 undisturbed  Daucus_carota         0           0 1_undisturb…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         6 undisturbed  Daucus_carota         0           0 6_undisturb…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         7 undisturbed  Daucus_carota         0           0 7_undisturb…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         9 undisturbed  Daucus_carota         0           0 9_undisturb…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>        10 undisturbed  Daucus_carota         0           0 10_undistur…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>        11 undisturbed  Daucus_carota         0           0 11_undistur…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>        13 undisturbed  Daucus_carota         1           0 13_undistur…     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>        15 undisturbed  Daucus_carota         0           0 15_undistur…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>        16 undisturbed  Daucus_carota         0           0 16_undistur…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        18 undisturbed  Daucus_carota         0           0 18_undistur…     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 30 more rows</span></span></span></code></pre></div>
<p>With these data we are interested in asking whether there is
phylogenetic structure in the distribution of these species, as well as
whether disturbance has any overall effects. To do this we will specify
two different phylogenetic effects in our <code>pglmm</code>, which uses
a syntax similar to <code>lmer</code> and <code>glmer</code> in the
<code>lme4</code> package for specifying random effects. We also include
site-level random effects to account for the paired design of the
experiment. We will start by modeling just presence and absence of
species (a binomial model). Note this model will take a while when using
maximum likelihood (the Bayesian method is much faster). This is the
full model specification:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm.html">pglmm</a></span><span class="op">(</span><span class="va">pres</span> <span class="op">~</span> <span class="va">disturbance</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                     <span class="op">(</span><span class="va">disturbance</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">@</span><span class="va">site</span><span class="op">)</span>, </span>
<span>                   data <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">data</span>, </span>
<span>                   cov_ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span>,</span>
<span>                   family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; as(&lt;matrix&gt;, "dgTMatrix") is deprecated since Matrix 1.5-0; do as(as(as(., "dMatrix"), "generalMatrix"), "TsparseMatrix") instead</span></span></code></pre></div>
<p>Here, we specified an overall phylogenetic effect using
<code>sp__</code>, which also automatically includes a nonphylogenetic
i.i.d. effect of species. <code>phyr</code> finds the linked
phylogenetic data because we specified the phylogeny in the
<code>cov_ranef</code> argument, giving it the name <code>sp</code>
which matches <code>sp__</code> but without the underscores. We can
include any number of phylogenies or covariance matrices in this way,
allowing us to model multiple sources of covariance in one model. In
this example, however, we will stick to one phylogeny to cover the
basics of how to run <code>pglmm</code> models. We use the same
phylogeny to model a second phylogenetic random effect, which is
specified as <code>sp__@site</code>. This is a “nested” phylogenetic
effect. This means that we are fitting an effect that had covariance
proportional to the species phylogeny, but independently for each site
(or “nested” in sites). We’ve also included a
disturbance-by-phylogenetic species effect
(<code>(disturbance | sp__)</code>), which estimates the degree to which
occurrence in disturbed vs. undisturbed habitat has a phylogenetic
signal. Like the main <code>sp__</code> effect, the
disturbance-by-<code>sp__</code> effect also includes an nonphylogenetic
species-by-disturbance interaction. Let’s look at the results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generalized linear mixed model for binomial data fit by restricted maximum likelihood</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:pres ~ disturbance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; logLik    AIC    BIC </span></span>
<span><span class="co">#&gt; -608.5 1234.9 1274.0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;                   Variance Std.Dev</span></span>
<span><span class="co">#&gt; 1|sp             2.0345532 1.42638</span></span>
<span><span class="co">#&gt; 1|sp__           0.0604946 0.24596</span></span>
<span><span class="co">#&gt; 1|site           0.0002416 0.01554</span></span>
<span><span class="co">#&gt; disturbance|sp   1.7800044 1.33417</span></span>
<span><span class="co">#&gt; disturbance|sp__ 0.0003680 0.01918</span></span>
<span><span class="co">#&gt; 1|sp__@site      0.0952042 0.30855</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                Value Std.Error  Zscore    Pvalue    </span></span>
<span><span class="co">#&gt; (Intercept) -2.72421   0.33520 -8.1272 4.393e-16 ***</span></span>
<span><span class="co">#&gt; disturbance  0.78423   0.28689  2.7336  0.006266 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The results of the random effects imply that the strongest effect is
an overall nonphylogenetic species effect, followed closely by a
disturbance-by-species effect. This implies that species vary strongly
in their occurrence in disturbed or undisturbed sites, that there is a
clear community difference between these treatments. The next strongest
effect is the nested phylogenetic effect. But how can we know if this
effect is strong enough to take seriously? Well one way to get an idea
is to run a likelihood ratio test on the random effect. This can be
achieved by using the <code><a href="../reference/pglmm-profile-LRT.html">pglmm_profile_LRT()</a></code> function, at
least for binomial models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">ss</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1|sp"             "1|sp__"           "1|site"           "disturbance|sp"  </span></span>
<span><span class="co">#&gt; [5] "disturbance|sp__" "1|sp__@site"</span></span>
<span><span class="va">test_nested</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-profile-LRT.html">pglmm_profile_LRT</a></span><span class="op">(</span><span class="va">mod</span>, re.number <span class="op">=</span> <span class="fl">6</span><span class="op">)</span> <span class="co">## sp__@site is the 6th random effect</span></span>
<span><span class="va">test_nested</span></span>
<span><span class="co">#&gt; $LR</span></span>
<span><span class="co">#&gt; [1] 4.037448</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $df</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Pr</span></span>
<span><span class="co">#&gt; [1] 0.002244134</span></span>
<span></span>
<span><span class="co"># alternatively, we can test all random effects</span></span>
<span><span class="va">LRTs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-profile-LRT.html">pglmm_profile_LRT</a></span><span class="op">(</span><span class="va">mod</span>, re.number <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">LRTs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">ss</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">LRTs</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  LR           df Pr          </span></span>
<span><span class="co">#&gt; 1|sp             54.01487     1  1.323873e-25</span></span>
<span><span class="co">#&gt; 1|sp__           0.2179382    1  0.2545597   </span></span>
<span><span class="co">#&gt; 1|site           -0.002140096 1  1           </span></span>
<span><span class="co">#&gt; disturbance|sp   15.94218     1  8.18144e-09 </span></span>
<span><span class="co">#&gt; disturbance|sp__ -0.001094586 1  1           </span></span>
<span><span class="co">#&gt; 1|sp__@site      4.037448     1  0.002244134</span></span></code></pre></div>
<p>This result shows that the nested phylogenetic effect is
statistically significant. What does this mean? A model where the
within-site distributions of species are explained by the phylogenetic
covariance of species implies a ‘phylogenetic attraction’ or
‘phylogenetic clustering’ effect, in which closely related species are
more likely to be found together in the same community. In the original
analysis of these data using traditional community phylogenetics methods
(null model based) found that the disturbed sites were phylogenetically
clustered but undisturbed sites were not. If the data are split in this
way, and each split modeled separately, does this result hold up?</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_disturbed</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm.html">pglmm</a></span><span class="op">(</span><span class="va">pres</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">@</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                               <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span>, </span>
<span>                             data <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                               <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">disturbance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                             cov_ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span>,</span>
<span>                             family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod_undisturbed</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm.html">pglmm</a></span><span class="op">(</span><span class="va">pres</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">@</span><span class="va">site</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                                 <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span>, </span>
<span>                               data <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                                 <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">disturbance</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>                               cov_ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span>,</span>
<span>                               family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Disturbed phylogenetic clustering test:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Disturbed phylogenetic clustering test:</span></span>
<span><span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-profile-LRT.html">pglmm_profile_LRT</a></span><span class="op">(</span><span class="va">mod_disturbed</span>, re.number <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $LR</span></span>
<span><span class="co">#&gt; [1] 4.680287</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $df</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Pr</span></span>
<span><span class="co">#&gt; [1] 0.001108513</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Undisturbed phylogenetic clustering test:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Undisturbed phylogenetic clustering test:</span></span>
<span><span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-profile-LRT.html">pglmm_profile_LRT</a></span><span class="op">(</span><span class="va">mod_undisturbed</span>, re.number <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; $LR</span></span>
<span><span class="co">#&gt; [1] -9.778163e-06</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $df</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Pr</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>Indeed! The original results hold up to this model-based test of the
same question. Whew! (╹◡╹)凸 We can also get an idea of how well the
model fits the data by plotting the observed and predicted values of the
model side-by-side.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pglmm-plot-data.html">plot_data</a></span><span class="op">(</span><span class="va">mod</span>, predicted <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/plot_mod-1.png" width="90%"></p>
<p>The other result from this model is that there is a strong fixed
effect of disturbance. In the context of a binomial multivariate model
such as <code>pglmm</code>, this means there is an overall increase in
the probability of occurrence in disturbed sites. In other words,
disturbed sites have a higher species richness at the site level (noting
that expected alpha species richness of a site can be expressed as Gamma
richness * E(prob_site(occurrence))).</p>
<p>Another way to explore the random effects is to use the Bayesian
version of <code>pglmm</code> and then look at the shape of the
posterior distribution of our random effect variance terms.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_bayes</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm.html">pglmm</a></span><span class="op">(</span><span class="va">pres</span> <span class="op">~</span> <span class="va">disturbance</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                     <span class="op">(</span><span class="va">disturbance</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp__</span><span class="op">@</span><span class="va">site</span><span class="op">)</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">data</span>, </span>
<span>                         cov_ranef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">phy</span><span class="op">)</span>,</span>
<span>                         family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                         bayes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         prior <span class="op">=</span> <span class="st">"pc.prior.auto"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_bayes</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generalized linear mixed model for binomial data fit by Bayesian INLA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:pres ~ disturbance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; marginal logLik             DIC            WAIC </span></span>
<span><span class="co">#&gt;          -613.7          1076.5          1074.4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;                  Variance Std.Dev lower.CI upper.CI</span></span>
<span><span class="co">#&gt; 1|sp              2.18050  1.4766 1.154345   5.0155</span></span>
<span><span class="co">#&gt; 1|sp__            0.07760  0.2786 0.013957   1.2137</span></span>
<span><span class="co">#&gt; 1|site            0.01340  0.1158 0.002886   0.1628</span></span>
<span><span class="co">#&gt; disturbance|sp    1.89726  1.3774 0.874554   5.0187</span></span>
<span><span class="co">#&gt; disturbance|sp__  0.05693  0.2386 0.011360   0.7239</span></span>
<span><span class="co">#&gt; 1|sp__@site       0.10329  0.3214 0.042105   0.3028</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                 Value  lower.CI upper.CI</span></span>
<span><span class="co">#&gt; (Intercept) -3.341844 -4.532512  -2.3481</span></span>
<span><span class="co">#&gt; disturbance  0.988023  0.027184   2.0254</span></span></code></pre></div>
<p>“pc.prior.auto” is a good choice to generate priors for binomial
models. If you are interested in the details of this kind of prior
(known as a penalizing complexity prior), check out this paper: <a href="https://arxiv.org/abs/1403.4630" class="external-link uri">https://arxiv.org/abs/1403.4630</a>.</p>
<p>The results of this model are consistent with the ML model, which is
good to see. Now we also have lower and upper credible intervals. We can
look at the full approximate marginal posterior distributions of the
random effects and fixed effects with the <code>plot_bayes</code>
function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_bayes.html">plot_bayes</a></span><span class="op">(</span><span class="va">mod_bayes</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `after_stat(density)` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">phyr</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;</span></span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/plot_bayes-1.png" width="85%"></p>
<p>What we are looking for is that the posterior distribution mode is
well away from zero, and that it looks relatively symmetrical. If it
were skewed and crammed up against the left side of the plot, near zero,
we would conclude that the effect is weak (remembering that variance
components cannot be less than or equal zero, so there will always be
some positive probability mass). The most obvious effects (well away
from zero) are again the species random effect, the
species-by-disturbance random effect, and the nested phylogenetic
effect. In this plot, the 95% credible interval is also plotted, along
with the posterior mean (the point and bar at the bottom of each
density). For the random effects these aren’t too meaningful, but they
can help distinguish genuine effects in the fixed effects. If these
credible intervals overlap zero in the fixed effects, the density will
be plotted with a lighter color to suggest it is not a strong effect
(although this is not relevant for this dataset, because both fixed
effects are strong).</p>
</div>
<div class="section level2">
<h2 id="model-assumption-checks">Model Assumption Checks<a class="anchor" aria-label="anchor" href="#model-assumption-checks"></a>
</h2>
<p>The next thing we might want to check is whether assumptions of the
model are met by the data. The typical way to do this is by plotting
and/or analyzing the model residuals. In non-Gaussian models such as
this one, this can be less straightforward. However, <code>phyr</code>
output supports the <code>DHARMa</code> package, which can generated a
generalized type of residual known as randomized quantile residuals (or
sometimes Dunn-Smyth residuals). These can be calculated and inspected
for nearly any error distribution. We can produce standard diagnostic
plots for our <code>pglmm</code> model by simply calling
<code><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html" class="external-link">DHARMa::simulateResiduals</a></code> on the model object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu">DHARMa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html" class="external-link">simulateResiduals</a></span><span class="op">(</span><span class="va">mod_bayes</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, ntry <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in checkModel(fittedModel): DHARMa: fittedModel not in class of</span></span>
<span><span class="co">#&gt; supported models. Absolutely no guarantee that this will work!</span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in rbinom(length(x), Ntrials, x): NAs produced</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resids</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/call_dharma-1.png" width="90%"></p>
<p>The residual plots look pretty good, though some of the tests failed.
Specifically the residual quantiles are not quite as flat with respect
to the model predictions as we would like them to be. There is a slight
curvature, and the residuals are overall increasing slightly with higher
predictions. Visually, however, this looks like a weak effect, and for
large datasets such as this, it is easy for the tests to fail. Thus, it
is likely that the statistical inference we get from the model is pretty
good. Given that we are interested in the effect of disturbance, we may
also want to check that the residuals do not show any strong patterns
with the disturbance treatment. This is simple to do with
<code>DHARMa</code> as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DHARMa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/plotResiduals.html" class="external-link">plotResiduals</a></span><span class="op">(</span><span class="va">resids</span>, <span class="va">mod_bayes</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">disturbance</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/some_other_plots-1.png" width="85%"></p>
<p>Obviously no problems there. This is also the case for the model
fitted by Maximum Likelihood method (<code>mod</code>).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resids_mod</span> <span class="op">&lt;-</span> <span class="fu">DHARMa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DHARMa/man/simulateResiduals.html" class="external-link">simulateResiduals</a></span><span class="op">(</span><span class="va">mod</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in checkModel(fittedModel): DHARMa: fittedModel not in class of</span></span>
<span><span class="co">#&gt; supported models. Absolutely no guarantee that this will work!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">resids_mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/call_dharma_mod-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="goodness-of-fit">Goodness of Fit<a class="anchor" aria-label="anchor" href="#goodness-of-fit"></a>
</h2>
<p>Another question about our model is simply how well it fits the data.
A metric appealing in its simplicity is the classic R<sup>2</sup>
metric, which purports to estimate the proportion of the variance in the
response explained by the model predictors. Once again, though, when
using non-Gaussian errors this can become a bit tricky. An additional
complication is created by model with random effects. Given that random
effects are very flexible model components (for example, nothing stops
you from fitting a random effect for each observation in your dataset),
a straight-up calculation of variance explains isn’t meaningful. That
said, methods that can produce a useful R<sup>2</sup> metric in the
complex situation have been developed. The <a href="https://github.com/arives/rr2" class="external-link">package <code>rr2</code></a> is
able to calculate several flavors of R<sup>2</sup>, and supports
<code>phyr</code>’s <code>pglmm</code> model object. Let’s try it!</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rr2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rr2/man/R2.html" class="external-link">R2</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Models of class pglmm do not have a R2_resid method.</span></span>
<span><span class="co">#&gt;    R2_lik   R2_pred </span></span>
<span><span class="co">#&gt; 0.1784547 0.4444387</span></span>
<span><span class="fu">rr2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rr2/man/R2.html" class="external-link">R2</a></span><span class="op">(</span><span class="va">mod_bayes</span><span class="op">)</span></span>
<span><span class="co">#&gt; Models of class pglmm do not have a R2_resid method.</span></span>
<span><span class="co">#&gt; Models of class pglmm with bayes = TRUE do not have a R2_lik method.</span></span>
<span><span class="co">#&gt;   R2_pred </span></span>
<span><span class="co">#&gt; 0.4547644</span></span></code></pre></div>
<p>There we go! R<sup>2</sup> = 0.44 for <code>mod</code> and
R<sup>2</sup> = 0.46 for <code>mod_bayes</code>! We can think of this as
saying roughly 44% (or 46%) of our response’s variance has been
explained by our model, taking into account the various sources of
covariance we modeled, subject to a boatload of assumption and caveats
of course. That’s handy! See <a href="https://academic.oup.com/sysbio/article/68/2/234/5098616" class="external-link">Ives
(2018)</a> for the full description of how this R<sup>2</sup> works.</p>
</div>
<div class="section level2">
<h2 id="auc-specificity-and-true-skill-statistics-tss">AUC, Specificity, and True Skill Statistics (TSS)<a class="anchor" aria-label="anchor" href="#auc-specificity-and-true-skill-statistics-tss"></a>
</h2>
<p>Assessments of predictive accuracy of Species Distribution Models are
generally based on confusion matrices that record the numbers of true
positive, false positive, true negative, and false negative. Such
matrices are straightforward to construct for models providing
presence-absence predictions, which is true for most SDMs. Commonly used
measures for SDMs include Specificity (true negative rate), Sensitivity
(true positive rate), True Skill Statistic (TSS = Sensitivity +
Specificity - 1), and area under the receiver operating characteristic
(ROC) curve (AUC) (<a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2664.2006.01214.x" class="external-link">Allouche
et al. 2006</a>). Combining the observed values with the predictions
generated by the <code><a href="../reference/pglmm-predicted-values.html">pglmm_predicted_values()</a></code> function, we can
calculate such measures to evaluate the performance of our models.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_mod</span> <span class="op">=</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-predicted-values.html">pglmm_predicted_values</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">Y_hat</span></span>
<span><span class="va">obs_mod</span> <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">pres</span></span>
<span><span class="va">roc_mod</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">obs_mod</span>, <span class="va">pred_mod</span>, percent <span class="op">=</span> <span class="cn">T</span>, direction <span class="op">=</span> <span class="st">"&lt;"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">AUC</span> <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc_mod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Area under the curve: 92.74%</span></span>
<span><span class="op">(</span><span class="va">roc_mod_2</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/coords.html" class="external-link">coords</a></span><span class="op">(</span><span class="va">roc_mod</span>, <span class="st">"best"</span>, ret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sens"</span>, <span class="st">"spec"</span><span class="op">)</span>, transpose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sensitivity specificity</span></span>
<span><span class="co">#&gt; 1   0.8561404   0.8494337</span></span>
<span><span class="op">(</span><span class="va">TSS</span> <span class="op">=</span> <span class="va">roc_mod_2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"sensitivity"</span><span class="op">]</span> <span class="op">+</span> <span class="va">roc_mod_2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"specificity"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7055741</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html" class="external-link">performance</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html" class="external-link">prediction</a></span><span class="op">(</span><span class="va">pred_mod</span>, <span class="va">obs_mod</span><span class="op">)</span>, measure <span class="op">=</span> <span class="st">"tpr"</span>, </span>
<span>                        x.measure <span class="op">=</span> <span class="st">"fpr"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"ROC Curve"</span><span class="op">)</span> <span class="co"># ROC curve</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/perfML-1.png" width="672"></p>
<p>We can see that the AUC is pretty high (0.9273677) with the model
fitted with maximum likelihood framework (<code>mod</code>). True
positive rates and true negative rates are also both reasonably high.
What about the model fitted with Bayesian framework
(<code>mod_bayes</code>)? Not surprising, the results are similar to
those of <code>mod</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_mod_bayes</span> <span class="op">=</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-predicted-values.html">pglmm_predicted_values</a></span><span class="op">(</span><span class="va">mod_bayes</span><span class="op">)</span><span class="op">$</span><span class="va">Y_hat</span></span>
<span><span class="va">obs_mod_bayes</span> <span class="op">=</span> <span class="va">mod_bayes</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">pres</span></span>
<span><span class="va">roc_mod_bayes</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">obs_mod_bayes</span>, <span class="va">pred_mod_bayes</span>, percent <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                           direction <span class="op">=</span> <span class="st">"&lt;"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">AUC_bayes</span> <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc_mod_bayes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Area under the curve: 93.16%</span></span>
<span><span class="op">(</span><span class="va">roc_mod_bayes2</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/coords.html" class="external-link">coords</a></span><span class="op">(</span><span class="va">roc_mod_bayes</span>, <span class="st">"best"</span>, ret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sens"</span>, <span class="st">"spec"</span><span class="op">)</span>,</span>
<span>                           transpose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sensitivity specificity</span></span>
<span><span class="co">#&gt; 1    0.877193   0.8374417</span></span>
<span><span class="op">(</span><span class="va">TSS_bayes</span> <span class="op">=</span> <span class="va">roc_mod_bayes2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"sensitivity"</span><span class="op">]</span> <span class="op">+</span> <span class="va">roc_mod_bayes2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"specificity"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7146347</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html" class="external-link">performance</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html" class="external-link">prediction</a></span><span class="op">(</span><span class="va">pred_mod_bayes</span>, <span class="va">obs_mod_bayes</span><span class="op">)</span>, measure <span class="op">=</span> <span class="st">"tpr"</span>, </span>
<span>                        x.measure <span class="op">=</span> <span class="st">"fpr"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"ROC Curve"</span><span class="op">)</span> <span class="co"># ROC curve</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/perfBayes-1.png" width="672"></p>
<p>Now let’s compare the model that does not account for phylogenetic
relationships, that is, the regular joint species distribution
models.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_bayes_no_phy</span> <span class="op">&lt;-</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm.html">pglmm</a></span><span class="op">(</span><span class="va">pres</span> <span class="op">~</span> <span class="va">disturbance</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">sp</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                                  <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">site</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">disturbance</span> <span class="op">|</span> <span class="va">sp</span><span class="op">)</span>, </span>
<span>                            data <span class="op">=</span> <span class="va">oldfield</span><span class="op">$</span><span class="va">data</span>, </span>
<span>                            family <span class="op">=</span> <span class="st">"binomial"</span>, bayes <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                            prior <span class="op">=</span> <span class="st">"pc.prior.auto"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_mod_bayes_no_phy</span> <span class="op">=</span> <span class="fu">phyr</span><span class="fu">::</span><span class="fu"><a href="../reference/pglmm-predicted-values.html">pglmm_predicted_values</a></span><span class="op">(</span><span class="va">mod_bayes_no_phy</span><span class="op">)</span><span class="op">$</span><span class="va">Y_hat</span></span>
<span><span class="va">obs_mod_bayes_no_phy</span> <span class="op">=</span> <span class="va">mod_bayes_no_phy</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">pres</span></span>
<span><span class="va">roc_mod_bayes_no_phy</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html" class="external-link">roc</a></span><span class="op">(</span><span class="va">obs_mod_bayes_no_phy</span>, <span class="va">pred_mod_bayes_no_phy</span>,</span>
<span>                                  percent <span class="op">=</span> <span class="cn">T</span>, direction <span class="op">=</span> <span class="st">"&lt;"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">AUC_bayes_no_phy</span> <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">roc_mod_bayes_no_phy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Area under the curve: 90.18%</span></span>
<span><span class="op">(</span><span class="va">roc_mod_bayes_no_phy2</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/coords.html" class="external-link">coords</a></span><span class="op">(</span><span class="va">roc_mod_bayes_no_phy</span>, <span class="st">"best"</span>, </span>
<span>                                       ret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sens"</span>, <span class="st">"spec"</span><span class="op">)</span>, transpose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sensitivity specificity</span></span>
<span><span class="co">#&gt; 1   0.8666667   0.7974684</span></span>
<span><span class="op">(</span><span class="va">TSS_bayes_no_phy</span> <span class="op">=</span> <span class="va">roc_mod_bayes_no_phy2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"sensitivity"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>    <span class="va">roc_mod_bayes_no_phy2</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"specificity"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.664135</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html" class="external-link">performance</a></span><span class="op">(</span><span class="fu">ROCR</span><span class="fu">::</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html" class="external-link">prediction</a></span><span class="op">(</span><span class="va">pred_mod_bayes_no_phy</span>, <span class="va">obs_mod_bayes_no_phy</span><span class="op">)</span>, </span>
<span>                       measure <span class="op">=</span> <span class="st">"tpr"</span>, x.measure <span class="op">=</span> <span class="st">"fpr"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"ROC Curve"</span><span class="op">)</span> <span class="co"># ROC curve</span></span></code></pre></div>
<p><img src="phyr_example_empirical_files/figure-html/perfBayesNoPhy-1.png" width="672"></p>
<p>Including species’ phylogenetic relationships in the model indeed
improved the model performance. After dropping the phylogenetic random
terms from the model, <code>AUC</code> decreased from 0.9316 to 0.9018
and <code>TSS</code> decreased from 0.7146 to 0.6641.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anthony Ives, Russell Dinnage, Lucas A. Nell, Matthew Helmus, Daijiang Li.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
